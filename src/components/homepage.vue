<template >
<!--  v-show="1 === 2"-->
  <div  class="co-home" @touchstart="gtouchstart($event)" @touchmove="gtouchmove($event)" @touchend="gtouchend($event)">
    <div v-for="(n, j) in userMessage" v-bind:key="j">
      <Card class="co-card" :bordered="false" v-for="(m, i) in n"
            v-show="home_to_user === true"
            v-bind:key="i"
      >
        <!--在todo里添加一个东西使整行被点击都会响应-->
        <p>被举报人：<span @click="actionClickUser" class="zhu">{{ m.be_report_invite_code }}</span></p>
        <p>被举报时间：{{ m.datetime }}</p>
        <p>举报类型：<span class="zhu">{{ m.report_type }}</span></p>
        <p>举报范围：{{ m.report_content }}</p>
        <p>举报状态：<span class="zhu">{{ m.be_report_status }}</span></p>
        <p>举报描述：{{ m.report_remark }}</p>
        <img class="co-image" v-bind:src=m.avatar>
        <div class="co-buttons-update" :data-id=m.id>
          <button @click="actionClickHandle" class="co-button-update">处理</button>
          <button @click="actionClickIgnore" class="co-button-update">忽略</button>
          <button @click="actionClickDetain" class="co-button-update">拘留</button>
        </div>
      </Card>
    </div>

    <UserHomePage
        ref="child"
        v-show="home_to_user === false"
        @fatherMethod="fatherMethod"
        v-bind:reportName="user_test"
    >
    </UserHomePage>

  </div>
</template>


<script>
import userHomePage from './userHomePage'
import apis from "../http/api.js"



export default {
  name: 'home',

  data: function() {
    return {
      userMessage: [],
      home_to_user: true,
      user_test: '',
      co_id: '',
      distance: 0,
      userPage: 1,
    }
  },
  created() {
    this.getData()
    this.getOptions()
  },
  methods: {
    gtouchstart(e){
      this.distance = e.targetTouches[0].pageY
    },
    gtouchmove(){
    },
    gtouchend(e){
      this.distance -= e.changedTouches[0].pageY
      if (this.distance > 30) {
        this.userPage += 1
        let t = this.userPage
        this.getData(t)
        console.log('this.userPage',this.userPage)
      }
    },
    getOptions: function() {
      apis.report_get_options().then(res => {
        const { data, errCode, msg } = res;
        if (errCode === 0) {
          console.log('getOptions', data)
        }
      }).catch()
    },
    getData: function(t = 1) {
      let params = {
        page: t,
        page_size: 10,
        start_datetime: '',
        end_datetime: '',
        be_report_invite_code: null,
        be_report_status: null,
        report_type: null,
        report_status: null,
        report_content: null,
        reporter_invite_code: null,
      }
      apis.report_get_data(params).then(res => {
        const { data, errCode, msg } = res;
        // console.log('data', res)
        if (errCode === 0) {
          // this.userMessage = res.data.records
          this.userMessage.push(res.data.records)
          console.log(res.data.records)
        }
      }).catch()
    },

    // 切换到个人页面
    actionClickUser: function(event) {
      this.home_to_user = false
      this.user_test = event.target.innerText
      console.log('this.user_test', this.user_test)
      this.$refs.child.getUserDetentionInfo(this.user_test)
    },

    actionClickHandle: function(event) {
      let self = event.target
      let buttons = self.closest('.co-buttons-update')
      let theButton = buttons.querySelectorAll('.co-button-update')[2]
      let ign = theButton.dataset.id
      // 删除这个邀请码的举报范围：
      // 1用户 => 用户的备考目标，昵称，设置默认值
      //
      // 2 cowall 删除
      // 3 评论  删除

    },
    fatherMethod() {
      console.log('测试')
      this.home_to_user = true
    },

    actionClickDetain: function(event) {
      let self = event.target
      let iWant = self.closest('.co-buttons-update')
      this.co_id = iWant.dataset.id
      console.log('co_id', this.co_id)
      let allWant = self.closest('.co-card')
      let value = allWant.querySelectorAll('.zhu')
      let be_report_invite_code = value[0].innerText
      let report_type = value[1].innerText
      let be_report_status = value[2].innerText
      console.log('be_report_invite_code', be_report_invite_code)
      this.$router.push({
        path:`/detain`,
        query: {
          co_id: this.co_id,
          be_report_invite_code: be_report_invite_code,
          report_type: report_type,
          be_report_status: be_report_status,
        }
      })
    },


    actionClickIgnore(event) {
      let self = event.target
      let iWant = self.closest('.co-buttons-update')
      let id = iWant.dataset.id
      // userCard.remove()
      // 此处添加移除数据库的此条记录
      let post_data = {
        id: id.toString(),
        check_type: 2
      };
      apis.report_report_check(post_data).then(res => {
        const { data, errCode, msg } = res;
        if (errCode === 0) {
          console.log('this.userMessage', this.userMessage)
          this.userMessage = []
          this.userMessage.push(this.getData(1))

        } else {
          alert(msg)
        }
      }).catch(err => {
        alert('接口异常')
      })
    }
  },
  components: {
    UserHomePage: userHomePage,
  }
}
</script>

<style>

.co-card{
  border: 1px solid #eee;
  padding: 2px 0;
  margin: 5px 0;
}
.co-home{
  background:#eee;
  padding: 5px;
  line-height: 5vh;
}
.co-buttons-update{
  position: absolute;
  right: 5vw;
  width: 20vw;
  top: 5%;
}
.co-button-update{
  background: white;
  border: 1px solid #eee;
  width: 18vw;
  margin: 3%;
  border-radius: 5px;
}
.co-image{
  width: 60%;
}

</style>